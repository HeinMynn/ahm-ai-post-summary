!function(e){"use strict";e(document).ready(function(){var t=ahmaipsu_editor_vars.post_id,a=!1;function s(){a||(a=!0,e.ajax({url:ahmaipsu_editor_vars.ajax_url,type:"POST",data:{action:"ahmaipsu_check_update",post_id:t,nonce:ahmaipsu_editor_vars.nonce},success:function(t){if(t.success){var n=e("#gpt-summary-text").text().trim(),u=t.data.summary,i=t.data.generating;if(u&&u!==n){e("#gpt-summary-text").text(u),e("#gpt-summary-preview").show(),e("#gpt-summary-placeholder").hide(),e("#gpt-summary-status").hide(),r(t.data.regenerated?"Summary regenerated!":"Summary generated!","success"),e('input[name="ahmaipsu_regenerate"]').prop("checked",!1),a=!1;return}if(i){setTimeout(function(){a=!1,s()},2e3);return}}e("#gpt-summary-status").hide(),a=!1},error:function(){e("#gpt-summary-status").hide(),a=!1}}))}function r(t,a){e("#gpt-summary-status").css({"background-color":"success"===a?"#d4edda":"#f8d7da",color:"success"===a?"#155724":"#721c24",border:"1px solid "+("success"===a?"#c3e6cb":"#f5c6cb")}).find(".spinner").hide().end().find("#gpt-summary-status-text").text(t).end().show(),"success"===a&&setTimeout(function(){e("#gpt-summary-status-text").html(t+'<br><small style="font-style: italic; opacity: 0.8;">If the summary did not update above, please refresh this page.</small>')},4e3),setTimeout(function(){e("#gpt-summary-status").fadeOut()},8e3)}e(document).on("click","#ahmaipsu-regenerate-btn",function(a){a.preventDefault();var s=e(this),r=e("#ahmaipsu-regenerate-status"),n=s.find(".dashicons");s.prop("disabled",!0),n.removeClass("dashicons-update").addClass("dashicons-update-alt"),s.addClass("ahmaipsu-spinning"),r.text("Generating new summary...").show(),e.ajax({url:ahmaipsu_editor_vars.ajax_url,type:"POST",data:{action:"ahmaipsu_regenerate_instantly",post_id:t,nonce:ahmaipsu_editor_vars.regenerate_nonce},success:function(t){t.success?(e("#gpt-summary-text").text(t.data.summary),e("#gpt-summary-preview").show(),e("#gpt-summary-placeholder").hide(),r.text("Summary regenerated successfully!").css("color","#46b450"),setTimeout(function(){r.fadeOut()},3e3)):r.text("Error: "+t.data).css("color","#dc3232")},error:function(){r.text("Network error occurred. Please try again.").css("color","#dc3232")},complete:function(){s.prop("disabled",!1),s.removeClass("ahmaipsu-spinning"),n.removeClass("dashicons-update-alt").addClass("dashicons-update")}})}),e(document).on("heartbeat-send",function(e,a){a.ahmaipsu_check={post_id:t}});var n=e("#gpt-summary-text").text().trim();e(document).on("heartbeat-tick.gpt-summary",function(e,a){a.wp_autosave&&a.wp_autosave.post_id==t&&setTimeout(s,1e3)});var u=window.location.href;setInterval(function(){window.location.href!==u&&(setTimeout(s,500),u=window.location.href)},1e3),e("form#post").on("submit",function(){var a=e('input[name="ahmaipsu_regenerate"]:checked').length>0,s=e('input[name="ahmaipsu_enabled"]:checked').length>0,u=!e("#gpt-summary-text").text().trim();if(a||s&&u){e("#gpt-summary-status").css({"background-color":"#fff3cd",color:"#856404",border:"1px solid #ffeaa7"}).find(".spinner").show().css("visibility","visible").end().find("#gpt-summary-status-text").text("Generating summary...").end().show();var i=setInterval(function(){e.ajax({url:ahmaipsu_editor_vars.ajax_url,type:"POST",data:{action:"ahmaipsu_check_update",post_id:t,original_summary:n,nonce:ahmaipsu_editor_vars.nonce},success:function(t){if(t.success){var a=t.data.summary;!t.data.generating&&a&&a!==n&&(e("#gpt-summary-text").text(a),e("#gpt-summary-preview").show(),e("#gpt-summary-placeholder").hide(),e("#gpt-summary-status").hide(),r(t.data.regenerated?"Summary regenerated!":"Summary generated!","success"),clearInterval(i),e('input[name="ahmaipsu_regenerate"]').prop("checked",!1),n=a)}},error:function(){e("#gpt-summary-status").hide(),clearInterval(i)}})},2e3);setTimeout(function(){clearInterval(i),e("#gpt-summary-status").hide()},3e4)}})})}(jQuery);