/**/**Post Editor JS for AHM AI Post Summary v1.1.4*/!function($){"use strict";$(document).ready(function(){var postId=ahmaipsu_editor_vars.post_id,checkingForUpdate=!1;function showStatusMessage(message,type){var statusEl=$("#gpt-summary-status");statusEl.removeClass("success error generating").addClass(type).text(message).show(),setTimeout(function(){statusEl.fadeOut()},3e3)}function checkSummaryUpdate(){if(!checkingForUpdate){checkingForUpdate=!0,$.ajax({url:ahmaipsu_editor_vars.ajax_url,type:"POST",data:{action:"ahmaipsu_check_update",post_id:postId,nonce:ahmaipsu_editor_vars.nonce},success:function(response){if(response.success){var currentDisplayed=$("#gpt-summary-text").text().trim(),newSummary=response.data.summary;newSummary&&newSummary!==currentDisplayed&&($("#gpt-summary-text").text(newSummary),$("#gpt-summary-preview").show(),$("#gpt-summary-placeholder").hide(),$("#gpt-summary-status").hide(),showStatusMessage(response.data.regenerated?"Summary regenerated successfully!":"Summary updated!","success")),response.data.generating&&showStatusMessage("Generating summary...","generating"),checkingForUpdate=!1}else showStatusMessage("Error checking for updates. Please try again.","error"),checkingForUpdate=!1},error:function(){showStatusMessage("Network error. Please try again.","error"),checkingForUpdate=!1}})}}$(document).on("click","#ahmaipsu-regenerate-btn",function(e){e.preventDefault();var $button=$(this),$status=$("#ahmaipsu-regenerate-status"),$icon=$button.find(".dashicons");$button.prop("disabled",!0),$icon.removeClass("dashicons-update").addClass("dashicons-update-alt ahmaipsu-spinning"),$status.text("Generating new summary...").show(),$.ajax({url:ahmaipsu_editor_vars.ajax_url,type:"POST",data:{action:"ahmaipsu_regenerate_instantly",post_id:postId,nonce:ahmaipsu_editor_vars.regenerate_nonce},success:function(response){response.success?($("#gpt-summary-text").text(response.data.summary),$("#gpt-summary-preview").show(),$("#gpt-summary-placeholder").hide(),$status.text("Summary regenerated successfully!").css("color","#46b450"),setTimeout(function(){$status.fadeOut()},3e3)):$status.text("Error: "+response.data).css("color","#dc3232")},error:function(){$status.text("Network error occurred. Please try again.").css("color","#dc3232")},complete:function(){$button.prop("disabled",!1),$icon.removeClass("dashicons-update-alt ahmaipsu-spinning").addClass("dashicons-update")}})}),checkSummaryUpdate(),setInterval(checkSummaryUpdate,5e3)})}(jQuery);/**Post Editor JS for AHM AI Post Summary v1.1.4*/!function($){"use strict";$(document).ready(function(){var postId=ahmaipsu_editor_vars.post_id,checkingForUpdate=!1;function showStatusMessage(message,type){var statusEl=$("#gpt-summary-status");statusEl.removeClass("success error generating").addClass(type).text(message).show(),setTimeout(function(){statusEl.fadeOut()},3e3)}function checkSummaryUpdate(){if(!checkingForUpdate){checkingForUpdate=!0,$.ajax({url:ahmaipsu_editor_vars.ajax_url,type:"POST",data:{action:"ahmaipsu_check_update",post_id:postId,nonce:ahmaipsu_editor_vars.nonce},success:function(response){if(response.success){var currentDisplayed=$("#gpt-summary-text").text().trim(),newSummary=response.data.summary;newSummary&&newSummary!==currentDisplayed&&($("#gpt-summary-text").text(newSummary),$("#gpt-summary-preview").show(),$("#gpt-summary-placeholder").hide(),$("#gpt-summary-status").hide(),showStatusMessage(response.data.regenerated?"Summary regenerated successfully!":"Summary updated!","success")),response.data.generating&&showStatusMessage("Generating summary...","generating"),checkingForUpdate=!1}else showStatusMessage("Error checking for updates. Please try again.","error"),checkingForUpdate=!1},error:function(){showStatusMessage("Network error. Please try again.","error"),checkingForUpdate=!1}})}}$(document).on("click","#ahmaipsu-regenerate-btn",function(e){e.preventDefault();var $button=$(this),$status=$("#ahmaipsu-regenerate-status"),$icon=$button.find(".dashicons");$button.prop("disabled",!0),$icon.removeClass("dashicons-update").addClass("dashicons-update-alt ahmaipsu-spinning"),$status.text("Generating new summary...").show(),$.ajax({url:ahmaipsu_editor_vars.ajax_url,type:"POST",data:{action:"ahmaipsu_regenerate_instantly",post_id:postId,nonce:ahmaipsu_editor_vars.regenerate_nonce},success:function(response){response.success?($("#gpt-summary-text").text(response.data.summary),$("#gpt-summary-preview").show(),$("#gpt-summary-placeholder").hide(),$status.text("Summary regenerated successfully!").css("color","#46b450"),setTimeout(function(){$status.fadeOut()},3e3)):$status.text("Error: "+response.data).css("color","#dc3232")},error:function(){$status.text("Network error occurred. Please try again.").css("color","#dc3232")},complete:function(){$button.prop("disabled",!1),$icon.removeClass("dashicons-update-alt ahmaipsu-spinning").addClass("dashicons-update")}})}),checkSummaryUpdate(),setInterval(checkSummaryUpdate,5e3)})}(jQuery);

 * Post Editor JavaScript for AHM AI Post Summary - Minified        url: ajaxurl,

 * Version: 1.1.4        type: "POST",

 */        data: {

!function($){"use strict";$(document).ready(function(){var postId=ahmaipsu_editor_vars.post_id,checkingForUpdate=!1;function showStatusMessage(message,type){var statusEl=$("#gpt-summary-status");statusEl.removeClass("success error generating").addClass(type).text(message).show(),setTimeout(function(){statusEl.fadeOut()},3e3)}function checkSummaryUpdate(){if(!checkingForUpdate){checkingForUpdate=!0,$.ajax({url:ahmaipsu_editor_vars.ajax_url,type:"POST",data:{action:"ahmaipsu_check_update",post_id:postId,nonce:ahmaipsu_editor_vars.nonce},success:function(response){if(response.success){var currentDisplayed=$("#gpt-summary-text").text().trim(),newSummary=response.data.summary;newSummary&&newSummary!==currentDisplayed&&($("#gpt-summary-text").text(newSummary),$("#gpt-summary-preview").show(),$("#gpt-summary-placeholder").hide(),$("#gpt-summary-status").hide(),showStatusMessage(response.data.regenerated?"Summary regenerated successfully!":"Summary updated!","success")),response.data.generating&&showStatusMessage("Generating summary...","generating"),checkingForUpdate=!1}else showStatusMessage("Error checking for updates. Please try again.","error"),checkingForUpdate=!1},error:function(){showStatusMessage("Network error. Please try again.","error"),checkingForUpdate=!1}})}}$(document).on("click","#ahmaipsu-regenerate-btn",function(e){e.preventDefault();var $button=$(this),$status=$("#ahmaipsu-regenerate-status"),$icon=$button.find(".dashicons");$button.prop("disabled",!0),$icon.removeClass("dashicons-update").addClass("dashicons-update-alt ahmaipsu-spinning"),$status.text("Generating new summary...").show(),$.ajax({url:ahmaipsu_editor_vars.ajax_url,type:"POST",data:{action:"ahmaipsu_regenerate_instantly",post_id:postId,nonce:ahmaipsu_editor_vars.regenerate_nonce},success:function(response){response.success?($("#gpt-summary-text").text(response.data.summary),$("#gpt-summary-preview").show(),$("#gpt-summary-placeholder").hide(),$status.text("Summary regenerated successfully!").css("color","#46b450"),setTimeout(function(){$status.fadeOut()},3e3)):$status.text("Error: "+response.data).css("color","#dc3232")},error:function(){$status.text("Network error occurred. Please try again.").css("color","#dc3232")},complete:function(){$button.prop("disabled",!1),$icon.removeClass("dashicons-update-alt ahmaipsu-spinning").addClass("dashicons-update")}})}),checkSummaryUpdate(),setInterval(checkSummaryUpdate,5e3)})}(jQuery);          action: "ahmaipsu_check_update",
          post_id: postId,
          nonce: ahmaipsu_editor_vars.check_nonce,
        },
        success: function (response) {
          if (response.success) {
            var currentDisplayed = $("#gpt-summary-text").text().trim();
            var newSummary = response.data.summary;
            var isGenerating = response.data.generating;
            if (newSummary && newSummary !== currentDisplayed) {
              $("#gpt-summary-text").text(newSummary);
              $("#gpt-summary-preview").show();
              $("#gpt-summary-placeholder").hide();
              $("#gpt-summary-status").hide();
              showStatusMessage(
                response.data.regenerated
                  ? "Summary regenerated!"
                  : "Summary generated!",
                "success"
              );
              $('input[name="ahmaipsu_regenerate"]').prop("checked", false);
              checkingForUpdate = false;
              return;
            }
            if (isGenerating) {
              setTimeout(function () {
                checkingForUpdate = false;
                checkSummaryUpdate();
              }, 2000);
              return;
            }
          }
          $("#gpt-summary-status").hide();
          checkingForUpdate = false;
        },
        error: function () {
          $("#gpt-summary-status").hide();
          checkingForUpdate = false;
        },
      });
    }
    function showStatusMessage(message, type) {
      var bgColor = type === "success" ? "#d4edda" : "#f8d7da";
      var textColor = type === "success" ? "#155724" : "#721c24";
      $("#gpt-summary-status")
        .css({
          "background-color": bgColor,
          color: textColor,
          border: "1px solid " + (type === "success" ? "#c3e6cb" : "#f5c6cb"),
        })
        .find(".spinner")
        .hide()
        .end()
        .find("#gpt-summary-status-text")
        .text(message)
        .end()
        .show();
      if (type === "success") {
        setTimeout(function () {
          $("#gpt-summary-status-text").html(
            message +
              '<br><small style="font-style: italic; opacity: 0.8;">If the summary did not update above, please refresh this page.</small>'
          );
        }, 4000);
      }
      setTimeout(function () {
        $("#gpt-summary-status").fadeOut();
      }, 8000);
    }
    $(document).on("heartbeat-send", function (event, data) {
      data.ahmaipsu_check = {post_id: postId};
    });
    var originalSummary = $("#gpt-summary-text").text().trim();
    $(document).on("heartbeat-tick.gpt-summary", function (e, data) {
      if (data.wp_autosave && data.wp_autosave.post_id == postId) {
        setTimeout(checkSummaryUpdate, 1000);
      }
    });
    var originalUrl = window.location.href;
    var urlCheckInterval = setInterval(function () {
      if (window.location.href !== originalUrl) {
        setTimeout(checkSummaryUpdate, 500);
        originalUrl = window.location.href;
      }
    }, 1000);
    $("form#post").on("submit", function () {
      var regenerateChecked =
        $('input[name="ahmaipsu_regenerate"]:checked').length > 0;
      var enabledChecked =
        $('input[name="ahmaipsu_enabled"]:checked').length > 0;
      var hasNoSummary = !$("#gpt-summary-text").text().trim();
      if (regenerateChecked || (enabledChecked && hasNoSummary)) {
        $("#gpt-summary-status")
          .css({
            "background-color": "#fff3cd",
            color: "#856404",
            border: "1px solid #ffeaa7",
          })
          .find(".spinner")
          .show()
          .css("visibility", "visible")
          .end()
          .find("#gpt-summary-status-text")
          .text("Generating summary...")
          .end()
          .show();
        var checkInterval = setInterval(function () {
          $.ajax({
            url: ajaxurl,
            type: "POST",
            data: {
              action: "ahmaipsu_check_update",
              post_id: postId,
              original_summary: originalSummary,
              nonce: ahmaipsu_editor_vars.check_nonce,
            },
            success: function (response) {
              if (response.success) {
                var newSummary = response.data.summary;
                var isGenerating = response.data.generating;
                if (
                  !isGenerating &&
                  newSummary &&
                  newSummary !== originalSummary
                ) {
                  $("#gpt-summary-text").text(newSummary);
                  $("#gpt-summary-preview").show();
                  $("#gpt-summary-placeholder").hide();
                  $("#gpt-summary-status").hide();
                  showStatusMessage(
                    response.data.regenerated
                      ? "Summary regenerated!"
                      : "Summary generated!",
                    "success"
                  );
                  clearInterval(checkInterval);
                  $('input[name="ahmaipsu_regenerate"]').prop("checked", false);
                  originalSummary = newSummary;
                }
              }
            },
            error: function () {
              $("#gpt-summary-status").hide();
              clearInterval(checkInterval);
            },
          });
        }, 2000);
        setTimeout(function () {
          clearInterval(checkInterval);
          $("#gpt-summary-status").hide();
        }, 30000);

