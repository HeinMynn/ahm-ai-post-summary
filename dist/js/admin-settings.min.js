!function(e){"use strict";function a(){var a=e("#ahmaipsu-settings-form"),t=e('#ahmaipsu-save-button, input[name="submit"]');a.length&&t.length&&a.on("submit",function(){t.val(),t.val("Saving..."),t.prop("disabled",!0),t.addClass("ahmaipsu-saving");var a=e('<div class="notice notice-info ahmaipsu-temp-notice"><p>\uD83D\uDCBE Saving your settings...</p></div>');e(".wrap h1").after(a),e(".notice:not(.ahmaipsu-temp-notice)").fadeOut()}),setTimeout(function(){e(".notice.notice-success, .notice.notice-error").not(".ahmaipsu-temp-notice").fadeOut(function(){e(this).remove()})},5e3)}function t(a){var t,i;e(".ahmaipsu-theme-option").removeClass("selected"),e('.ahmaipsu-theme-option[data-theme="'+a+'"]').addClass("selected"),e('.ahmaipsu-theme-option[data-theme="'+a+'"] .ahmaipsu-theme-preview').addClass("ahmaipsu-preview-selected"),setTimeout(function(){e(".ahmaipsu-theme-preview").removeClass("ahmaipsu-preview-selected")},600),t=a,e(".ahmaipsu-theme-selected-message").remove(),i=e('<div class="ahmaipsu-theme-selected-message"><p><strong>✓ Theme Selected:</strong> '+(({classic:"\uD83C\uDFAF Classic",minimal:"✨ Minimal",modern:"\uD83D\uDE80 Modern",elegant:"\uD83D\uDC8E Elegant",card:"\uD83D\uDCCB Card"})[t]||t)+" theme will be applied to your summaries when you save the settings.</p></div>"),e(".ahmaipsu-theme-selector").before(i),setTimeout(function(){i.fadeOut(500,function(){e(this).remove()})},4e3)}function i(){var a=e("#ahmaipsu_api_key").val().trim(),t=e("#validate-api-key");a&&a.length>0?t.show():(t.hide(),e("#api-validation-result").empty())}function a(){e("#ahmaipsu-settings-form").on("submit",function(){var a=e("#ahmaipsu-save-button");a.val(),a.val(ahmaipsu_admin_vars.saving_text||"Saving..."),a.prop("disabled",!0),a.addClass("ahmaipsu-saving")}),setTimeout(function(){e(".notice.is-dismissible").fadeOut()},5e3)}e(document).ready(function(){var n;e(".tab-content:not(.active)").hide(),e(".nav-tab").on("click",function(a){a.preventDefault(),e(".nav-tab").removeClass("nav-tab-active"),e(".tab-content").removeClass("active").hide(),e(this).addClass("nav-tab-active");var t=e(this).data("tab");e("#"+t+"-tab").addClass("active").show()}),e("#ahmaipsu_api_provider").on("change",function(){"gemini"===e(this).val()?(e("#gemini-instructions").show(),e("#chatgpt-instructions").hide()):(e("#gemini-instructions").hide(),e("#chatgpt-instructions").show()),i()}),e("#ahmaipsu_api_key").on("input change",function(){i()}),e(document).on("click","#validate-api-key",function(){(function a(){var t=e("#ahmaipsu_api_key").val().trim(),i=e("#ahmaipsu_api_provider").val()||"gemini",n=e("#validate-api-key"),s=e("#api-validation-result");if(!t){s.html('<div class="notice notice-error inline"><p>Please enter an API key to validate.</p></div>');return}n.prop("disabled",!0),n.html('<span class="dashicons dashicons-update" style="animation: rotation 1s infinite linear; margin-right: 5px; vertical-align: text-bottom;"></span>Validating...'),s.html('<div class="notice notice-info inline"><p>⏳ Testing API connection...</p></div>'),e.ajax({url:ahmaipsu_admin_vars.ajax_url,type:"POST",data:{action:"ahmaipsu_validate_api_key",api_key:t,api_provider:i,nonce:ahmaipsu_admin_vars.validate_nonce},success:function(e){e.success?s.html('<div class="notice notice-success inline"><p>'+e.data+"</p></div>"):s.html('<div class="notice notice-error inline"><p>❌ '+e.data+"</p></div>")},error:function(e,a,t){s.html('<div class="notice notice-error inline"><p>❌ Connection failed: '+t+"</p></div>")},complete:function(){n.prop("disabled",!1),n.html('<span class="dashicons dashicons-shield-alt" style="margin-right: 5px; vertical-align: text-bottom;"></span>Validate API Key')}})})()}),i(),e("#generate_test_summary").on("click",function(){var a=e("#test_content").val();a&&(e("#test_result").html("Generating summary..."),e.ajax({url:ajaxurl,type:"POST",data:{action:"ahmaipsu_test",content:a,nonce:ahmaipsu_admin_vars.test_nonce},success:function(a){a.success?e("#test_result").html("<strong>Summary:</strong> "+a.data):e("#test_result").html('<span style="color: red;">Error: '+a.data+"</span>")}}))}),(n=e("#ahmaipsu_selected_theme").val())&&t(n),e(".ahmaipsu-theme-option").on("click",function(a){var i=e(this).data("theme"),n=e("#ahmaipsu_selected_theme").val();i!==n&&(e("#ahmaipsu_selected_theme").val(i),t(i))}),e(".ahmaipsu-theme-option").on("mouseenter",function(){var a=e(this).data("theme"),t=e("#ahmaipsu_selected_theme").val();a!==t&&e(this).addClass("ahmaipsu-theme-hover")}).on("mouseleave",function(){e(this).removeClass("ahmaipsu-theme-hover")}),a()}),window.ahmaipsu_init_api_validation=function(){document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('input[name="ahmaipsu_settings[ahmaipsu_api_key]"]'),a=document.getElementById("ahmaipsu_global_enable");function t(){""!==e.value.trim()?a.disabled=!1:(a.disabled=!0,a.checked=!1)}e&&(e.addEventListener("input",t),e.addEventListener("change",t))})},a()}(jQuery);